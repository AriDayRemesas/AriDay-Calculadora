<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AriDay Remesas</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1.5rem;
      background: #f5f5f5;
    }
    .card {
      background: #fff;
      max-width: 450px;
      margin: auto;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      margin: 0;
      font-size: 1.5rem;
    }
    p.subtitle {
      margin: 0.2rem 0 1rem;
      font-size: 0.9rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    .selector-group {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    select {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
      margin: 0 0.5rem;
    }
    button, input {
      width: 100%;
      margin-top: 1rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .swap-btn {
      padding: 0.5rem 0.8rem;
      border: none;
      background: #1a73e8;
      color: #fff;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 1.2rem;
      line-height: 1;
    }
    .btn-enviar {
      background-color: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.7rem;
      margin-top: 0.5rem;
      cursor: pointer;
      font-size: 1rem;
    }
    .result {
      margin-top: 1.2rem;
      font-weight: bold;
      font-size: 1.1rem;
      color: #1a73e8;
    }
  </style>
</head>
<body>

  <div class="card">
    <h2>üåê AriDay Remesas</h2>
    <p class="subtitle">
      <a href="https://wa.me/5491165218910" target="_blank" style="text-decoration:none; color:#1a73e8;">
        WhatsApp: +54 9 11 6521 8910
      </a>
    </p>

    <label>Convertir de ‚Üí a:</label>
    <div class="selector-group">
      <select id="currencyFrom">
        <option value="ARS">ARS</option>
        <option value="CUP">CUP</option>
      </select>
      <button type="button" class="swap-btn" onclick="swapCurrencies()">‚áÑ</button>
      <select id="currencyTo">
        <option value="CUP">CUP</option>
        <option value="ARS">ARS</option>
      </select>
    </div>

    <label for="amount">Ingrese monto (m√°x. 9 d√≠gitos):</label>
    <input type="text" id="amount" placeholder="Ej: 15,000" maxlength="13" />

    <div class="result" id="resultText"></div>
    <button onclick="calculate()">Calcular</button>
    <button class="btn-enviar" onclick="sendToWhatsApp()">Enviar</button>
  </div>

  <script>
    // Par√°metros fijos
    const MIN_ARS = 12000;     // 12.000 ARS = 3.243 CUP
    const MIN_CUP = 3243;      
    const THRESHOLD_CUP = 100000;   // 100.000 CUP
    const THRESHOLD_ARS = 363000;   // 363.000 ARS
    const RATE_MIN = 3.69;     // 1 CUP = 3.69 ARS al m√≠nimo
    const RATE_MAX = 3.63;     // 1 CUP = 3.63 ARS a partir de 100.000 CUP

    let lastResult = ''; // Guardar texto de resultado para enviar

    // Inicializar deshabilitaci√≥n cruzada al cargar
    window.onload = () => {
      updateDisabledOptions();
      document.getElementById('currencyFrom').addEventListener('change', updateDisabledOptions);
      document.getElementById('currencyTo').addEventListener('change', updateDisabledOptions);
      document.getElementById('amount').addEventListener('input', enforceNumericInput);
    };

    // Permitir solo n√∫meros, m√°ximo 9 d√≠gitos, y formatear con comas
    function enforceNumericInput(event) {
      let value = event.target.value.replace(/\D/g, '');
      if (value.length > 9) {
        value = value.slice(0, 9);
      }
      // Insertar comas cada tres d√≠gitos
      value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      event.target.value = value;
    }

    // Deshabilita la misma opci√≥n en ambos selects
    function updateDisabledOptions() {
      const from = document.getElementById('currencyFrom').value;
      const toSelect = document.getElementById('currencyTo');
      for (let i = 0; i < toSelect.options.length; i++) {
        toSelect.options[i].disabled = (toSelect.options[i].value === from);
      }
      if (from === toSelect.value) {
        toSelect.value = (from === 'ARS') ? 'CUP' : 'ARS';
      }
    }

    // Intercambiar valores de los selects
    function swapCurrencies() {
      const fromSelect = document.getElementById('currencyFrom');
      const toSelect = document.getElementById('currencyTo');
      const temp = fromSelect.value;
      fromSelect.value = toSelect.value;
      toSelect.value = temp;
      updateDisabledOptions();
      document.getElementById('amount').value = '';
      document.getElementById('resultText').textContent = '';
      lastResult = '';
    }

    // Calcula la tasa progresiva seg√∫n cantidad en CUP
    function rateForCup(cup) {
      if (cup <= MIN_CUP) {
        return RATE_MIN;
      }
      if (cup >= THRESHOLD_CUP) {
        return RATE_MAX;
      }
      const slope = (RATE_MAX - RATE_MIN) / (THRESHOLD_CUP - MIN_CUP);
      return RATE_MIN + slope * (cup - MIN_CUP);
    }

    // Convierte CUP ‚Üí ARS o ARS ‚Üí CUP
    function cupToArs(cup) {
      const rate = rateForCup(cup);
      return cup * rate;
    }
    function arsToCup(ars) {
      if (ars >= THRESHOLD_ARS) {
        return Math.floor(ars / RATE_MAX);
      }
      let low = MIN_CUP, high = THRESHOLD_CUP, mid, estimate;
      for (let i = 0; i < 50; i++) {
        mid = (low + high) / 2;
        estimate = cupToArs(mid);
        if (estimate > ars) {
          high = mid;
        } else {
          low = mid;
        }
      }
      return mid;
    }

    function calculate() {
      const from = document.getElementById('currencyFrom').value;
      const to = document.getElementById('currencyTo').value;
      const raw = document.getElementById('amount').value;
      // Remover comas antes de convertir
      const numericValue = parseFloat(raw.replace(/,/g, ''));
      const resultDiv = document.getElementById('resultText');
      resultDiv.textContent = '';
      lastResult = '';

      if (from === to) {
        resultDiv.textContent = 'Seleccione monedas diferentes.';
        return;
      }

      if (!raw || isNaN(numericValue)) {
        resultDiv.textContent = 'Ingrese un monto v√°lido.';
        return;
      }

      if (from === 'ARS' && to === 'CUP') {
        if (numericValue < MIN_ARS) {
          resultDiv.textContent = `Por favor ingrese ARS ‚â• ${MIN_ARS.toLocaleString()}.`;
          return;
        }
        const cup = arsToCup(numericValue);
        const roundedCup = Math.round(cup);
        resultDiv.textContent = `üí≤ Con ${numericValue.toLocaleString()} ARS recib√≠s aprox. ${roundedCup.toLocaleString()} CUP.`;
        lastResult = `Quiero enviar ${numericValue.toLocaleString()} ARS para recibir ${roundedCup.toLocaleString()} CUP.`;
      }
      else if (from === 'CUP' && to === 'ARS') {
        if (numericValue < MIN_CUP) {
          resultDiv.textContent = `Por favor ingrese CUP ‚â• ${MIN_CUP.toLocaleString()}.`;
          return;
        }
        const ars = cupToArs(numericValue);
        const roundedArs = Math.round(ars);
        resultDiv.textContent = `üí≤ Recib√≠s aprox. ${numericValue.toLocaleString()} CUP con ${roundedArs.toLocaleString()} ARS.`;
        lastResult = `Quiero enviar ${roundedArs.toLocaleString()} ARS para recibir ${numericValue.toLocaleString()} CUP.`;
      }
    }

    // Env√≠a el mensaje al n√∫mero de WhatsApp
    function sendToWhatsApp() {
      if (!lastResult) {
        alert('Primero calcula un monto v√°lido antes de enviar.');
        return;
      }
      const phone = '5491165218910';
      const text = encodeURIComponent(lastResult);
      window.open(`https://wa.me/${phone}?text=${text}`, '_blank');
    }
  </script>

</body>
</html>
